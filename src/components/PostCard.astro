---
import { formatDate, getFeaturedImageUrl, getPostCategories, getExcerptText, type WPPost } from '../lib/wordpress';

interface Props {
  post: WPPost;
}

const { post } = Astro.props;
const featuredImage = getFeaturedImageUrl(post, 'medium_large');
const categories = getPostCategories(post);
const excerpt = getExcerptText(post.excerpt.rendered, 100);
---

<article class="group pixel-border overflow-hidden transition-transform hover:-translate-y-1" style="background: var(--color-cream);">
  <a href={`/blog/${post.slug}`} class="block">
    {featuredImage && (
      <div class="relative aspect-video overflow-hidden">
        <img
          src={featuredImage}
          alt={post.title.rendered}
          class="w-full h-full object-cover transition-transform group-hover:scale-105"
          loading="lazy"
        />
        <!-- Pixel scanline overlay -->
        <div class="absolute inset-0 bg-[repeating-linear-gradient(0deg,transparent,transparent_2px,rgba(0,0,0,0.03)_2px,rgba(0,0,0,0.03)_4px)] pointer-events-none" />
      </div>
    )}

    <div class="p-4">
      {categories.length > 0 && (
        <div class="flex gap-2 mb-3">
          {categories.slice(0, 2).map((cat) => (
            <span class="pixel-tag">
              {cat.name}
            </span>
          ))}
        </div>
      )}

      <h2
        class="font-pixel text-xs leading-relaxed group-hover:opacity-80"
        style="color: var(--color-brown-dark);"
        set:html={post.title.rendered}
      />

      <p class="mt-3 text-sm line-clamp-2" style="color: var(--color-brown);">
        {excerpt}
      </p>

      <div class="mt-4 pt-3" style="border-top: 2px dashed var(--color-brown);">
        <time class="font-pixel text-[8px]" style="color: var(--color-brown);" datetime={post.date}>
          {formatDate(post.date)}
        </time>
      </div>
    </div>
  </a>
</article>
