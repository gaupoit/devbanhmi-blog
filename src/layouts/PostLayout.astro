---
import BaseLayout from './BaseLayout.astro';
import { formatDate, getFeaturedImageUrl, getAuthor, getPostCategories, getExcerptText, processContent, type WPPost } from '../lib/wordpress';

interface Props {
  post: WPPost;
}

const { post } = Astro.props;
const featuredImage = getFeaturedImageUrl(post);
const author = getAuthor(post);
const categories = getPostCategories(post);
const description = getExcerptText(post.excerpt.rendered);
const content = processContent(post.content.rendered);
---

<BaseLayout title={post.title.rendered} description={description} image={featuredImage || undefined}>
  <article class="max-w-3xl mx-auto">
    <!-- Pixel-styled header -->
    <header class="pixel-border p-6 sm:p-8 mb-8" style="background: var(--color-cream);">
      {categories.length > 0 && (
        <div class="mb-4 flex flex-wrap gap-2">
          {categories.map((cat) => (
            <a
              href={`/blog/category/${cat.slug}`}
              class="pixel-tag hover:opacity-80"
            >
              {cat.name}
            </a>
          ))}
        </div>
      )}

      <h1
        class="font-pixel text-sm sm:text-base leading-relaxed"
        style="color: var(--color-brown-dark);"
        set:html={post.title.rendered}
      />

      <div class="mt-6 flex items-center gap-4 pt-4" style="border-top: 2px dashed var(--color-brown);">
        {author && (
          <div class="flex items-center gap-3">
            {author.avatar_urls?.['48'] && (
              <img
                src={author.avatar_urls['48']}
                alt={author.name}
                class="h-10 w-10 pixel-border-thin"
              />
            )}
            <span class="text-sm font-medium" style="color: var(--color-brown-dark);">{author.name}</span>
          </div>
        )}
        <time class="font-pixel text-[8px]" style="color: var(--color-brown);" datetime={post.date}>
          {formatDate(post.date)}
        </time>
      </div>
    </header>

    <!-- Featured image -->
    {featuredImage && (
      <div class="pixel-border mb-8 overflow-hidden">
        <img
          src={featuredImage}
          alt={post.title.rendered}
          class="aspect-video w-full object-cover"
        />
      </div>
    )}

    <!-- Article content -->
    <div class="pixel-border p-6 sm:p-8" style="background: var(--color-cream);">
      <div class="prose prose-pixel max-w-none" set:html={content} />
    </div>

    <!-- Back link -->
    <div class="mt-8 text-center">
      <a href="/blog" class="pixel-btn px-5 py-3">
        &lt;&lt; Back to Blog
      </a>
    </div>
  </article>
</BaseLayout>
