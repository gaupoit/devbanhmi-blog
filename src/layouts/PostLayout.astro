---
import BaseLayout from './BaseLayout.astro';
import { formatDate, getFeaturedImageUrl, getAuthor, getPostCategories, getExcerptText, type WPPost } from '../lib/wordpress';

interface Props {
  post: WPPost;
}

const { post } = Astro.props;
const featuredImage = getFeaturedImageUrl(post);
const author = getAuthor(post);
const categories = getPostCategories(post);
const description = getExcerptText(post.excerpt.rendered);
---

<BaseLayout title={post.title.rendered} description={description} image={featuredImage || undefined}>
  <article class="prose prose-gray mx-auto dark:prose-invert lg:prose-lg">
    <header class="not-prose mb-8">
      {categories.length > 0 && (
        <div class="mb-4 flex gap-2">
          {categories.map((cat) => (
            <a
              href={`/blog/category/${cat.slug}`}
              class="text-xs font-medium uppercase tracking-wide text-blue-600 hover:text-blue-800 dark:text-blue-400"
            >
              {cat.name}
            </a>
          ))}
        </div>
      )}

      <h1 class="text-3xl font-bold tracking-tight sm:text-4xl" set:html={post.title.rendered} />

      <div class="mt-4 flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
        {author && (
          <div class="flex items-center gap-2">
            {author.avatar_urls?.['48'] && (
              <img
                src={author.avatar_urls['48']}
                alt={author.name}
                class="h-8 w-8 rounded-full"
              />
            )}
            <span>{author.name}</span>
          </div>
        )}
        <time datetime={post.date}>{formatDate(post.date)}</time>
      </div>
    </header>

    {featuredImage && (
      <img
        src={featuredImage}
        alt={post.title.rendered}
        class="mb-8 aspect-video w-full rounded-lg object-cover"
      />
    )}

    <div set:html={post.content.rendered} />
  </article>
</BaseLayout>

<style is:global>
  @reference "../styles/global.css";

  /* Code block styling for WordPress content */
  .prose pre {
    @apply overflow-x-auto rounded-lg bg-gray-900 p-4 text-sm;
  }

  .prose code {
    @apply rounded bg-gray-100 px-1.5 py-0.5 text-sm dark:bg-gray-800;
  }

  .prose pre code {
    @apply bg-transparent p-0;
  }
</style>
