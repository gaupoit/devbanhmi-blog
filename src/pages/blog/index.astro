---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import { getPosts } from '../../lib/wordpress';

let posts = [];
let error = null;

try {
  posts = await getPosts({ perPage: 20 });
} catch (e) {
  error = e instanceof Error ? e.message : 'Failed to fetch posts';
  console.error('Error fetching posts:', e);
}
---

<BaseLayout title="Blog" description="All blog posts about software engineering, AI, and startup lessons.">
  <h1 class="text-3xl font-bold tracking-tight sm:text-4xl">Blog</h1>
  <p class="mt-2 text-gray-600 dark:text-gray-400">
    Thoughts on software engineering, AI, and building products.
  </p>

  <div class="mt-10">
    {error ? (
      <div class="rounded-lg border border-yellow-200 bg-yellow-50 p-6 dark:border-yellow-900 dark:bg-yellow-950">
        <p class="text-yellow-800 dark:text-yellow-200">
          <strong>Note:</strong> Unable to fetch posts from WordPress.
        </p>
        <p class="mt-2 text-sm text-yellow-700 dark:text-yellow-300">
          Configure <code class="rounded bg-yellow-100 px-1 dark:bg-yellow-900">WORDPRESS_API_URL</code> in your environment.
        </p>
      </div>
    ) : posts.length === 0 ? (
      <p class="text-gray-600 dark:text-gray-400">No posts yet.</p>
    ) : (
      <div class="grid gap-10 sm:grid-cols-2">
        {posts.map((post) => (
          <PostCard post={post} />
        ))}
      </div>
    )}
  </div>
</BaseLayout>
