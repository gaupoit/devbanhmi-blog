---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import { getPosts } from '../../lib/wordpress';

let posts = [];
let error = null;

try {
  posts = await getPosts({ perPage: 20 });
} catch (e) {
  error = e instanceof Error ? e.message : 'Failed to fetch posts';
  console.error('Error fetching posts:', e);
}
---

<BaseLayout title="Blog" description="All blog posts about software engineering, AI, and startup lessons.">
  <!-- Page header -->
  <div class="pixel-border p-6 mb-8" style="background: var(--color-cream);">
    <h1 class="font-pixel text-base" style="color: var(--color-brown-dark);">Blog</h1>
    <p class="mt-2" style="color: var(--color-brown);">
      Thoughts on software engineering, AI, and building products.
    </p>
  </div>

  <!-- Posts grid -->
  <div>
    {error ? (
      <div class="pixel-border p-6" style="background: var(--color-bread-light);">
        <p class="font-pixel text-[10px]" style="color: var(--color-brown-dark);">
          Note: Unable to fetch posts.
        </p>
        <p class="mt-2 text-sm" style="color: var(--color-brown);">
          Configure <code class="pixel-tag">WORDPRESS_API_URL</code> in your environment.
        </p>
      </div>
    ) : posts.length === 0 ? (
      <div class="pixel-border p-6 text-center" style="background: var(--color-cream);">
        <p class="font-pixel text-xs" style="color: var(--color-brown);">No posts yet.</p>
      </div>
    ) : (
      <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {posts.map((post) => (
          <PostCard post={post} />
        ))}
      </div>
    )}
  </div>
</BaseLayout>
